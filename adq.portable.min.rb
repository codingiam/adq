require'io/console';X,Y=15,10;U,D,L,R=-X,X,-1,1;f=Array.new S=X*Y,'.';t=[h=X*(Y+1)/2];f[h]='*';(g=->{f[f.zip(0..).select{|v,_|v=='.'}.sample[1]]='+'}).();m,s=U,0;Thread.new{loop{k=STDIN.getch;m=k=='q'&&exit||k=='w'&&U||k=='s'&&D||k=='a'&&L||k=='d'&&R||m}};begin;print"\e[2J\e[?25l";loop{h+=m;m==U&&h<0&&h+=S;m==D&&h>=S&&h-=S;m==R&&h%X==0&&h-=X;m==L&&h%X==X-1&&h+=X;f[h]=='*'&&break;f[h]!='+'?(f[t[0]]='.';t=t.drop(1)):(s+=1;g.());t<<h;f[h]='*';print"\e[H";f.each_slice(X){|c|puts"#{c.join}\e[#{X}D"};puts"+#{s}\e[#{X}D";sleep 0.2}ensure;print"\e[?25h";end